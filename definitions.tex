%% definitions.tex - definitions of kernel reductions and equivalence classes
%%
%% Copyright 2010, 2011, 2012, 2014 Jeffrey Finkelstein.
%%
%% This LaTeX markup document is made available under the terms of the Creative
%% Commons Attribution-ShareAlike 4.0 International License,
%% https://creativecommons.org/licenses/by-sa/4.0/.
\section{Definitions of \texorpdfstring{\NPEq}{NPEq}}
\label{sec:definitions}

In this section we examine possible alternate definitions of \NPEq.
The main property of languages in $\NP$ is that membership in each language is verifiable in polynomial time, given a witness to the membership.
We propose here several possible definitions of $\NPEq$ in order to determine which make sense, which are too restrictive, and which are equivalent.

For the sake of brevity, in all definitions below, when we write $\exists w$, we mean $\exists w$ with length polynomially bounded with respect to the length of $x$, $y$, or the pair $\pair{x}{y}$ (depending on the requirements of the particular definition).

The first two definitions are analogs of the two fundamental definitions of \NP.
\begin{definition}\label{def:npeq1}
  An equivalence relation $R$ is in $\NPEqOne$ if there exists a non-deterministic Turing machine, call it $N$, which halts in time polynomial in the length of the input, such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff N(\pair{x}{y})\plain{accepts}
  \end{displaymath}
\end{definition}
\begin{definition}\label{def:npeq2}
  An equivalence relation $R$ is in $\NPEqTwo$ if there exists a language $L\in\P$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w\colon \pair{\pair{x}{y}}{w}\in L
  \end{displaymath}
\end{definition}

The next two definitions attempt to require that the witness language is itself an equivalence relation, instead of an arbitrary language in $\P$, as in \autoref{def:npeq2}.
\begin{definition}\label{def:npeq3}
  An equivalence relation $R$ is in $\NPEqThree$ if there exists an equivalence relation $R'\in \PEq$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w_x,w_y\colon \pair{\pair{x}{w_x}}{\pair{y}{w_y}}\in R'
  \end{displaymath}
\end{definition}
\begin{definition}\label{def:npeq4}
  An equivalence relation $R$ is in $\NPEqFour$ if there exists an equivalence relation $R'\in \PEq$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w\colon \pair{\pair{x}{w}}{\pair{y}{w}}\in R'
  \end{displaymath}
\end{definition}

The next two definitions attempt to allow the possibility of not just a simple string which witnesses the equivalence of $x$ and $y$, but a ``witness function'' which may map $x$ and $y$, along with witness strings, to an equivalence relation in \PEq.
\begin{definition}\label{def:npeq5}
  An equivalence relation $R$ is in $\NPEqFive$ if there exists an equivalence relation $R'\in \PEq$ and a function $f\in\FP$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w_x,w_y\colon \pair{f(x, w_x)}{f(y, w_y)}\in R'
  \end{displaymath}
\end{definition}
\begin{definition}\label{def:npeq6}
  An equivalence relation $R$ is in $\NPEqSix$ if there exists an equivalence relation $R'\in \PEq$ and a function $f\in\FP$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w\colon \pair{f(x, w)}{f(y, w)}\in R'
  \end{displaymath}
\end{definition}

The final two definitions attempt to describe equivalence relations for which there is a ``witnessed complete invariant'', which maps equivalent strings to equal strings when given access to some witness of their equivalence.
We say that an equivalence relation $R$ on a universe $U$ has a \defn{one-witness complete invariant} if there exists a function $f\colon U\times S\to T$ such that $(x,y)\in R$ if and only if $\exists w\in S\colon f(x, w)=f(y, w)$, and we say that it has a \defn{two-witness complete invariant} if $(x, y)\in R$ if and only if $\exists w_x, w_y\in S\colon f(x, w_x)=f(y, w_y)$.
\begin{definition}\label{def:npeq7}
  An equivalence relation $R$ is in $\NPEqSeven$ if it has a polynomial time computable two-witness complete invariant, that is, a function $f\in\FP$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w_x, w_y\colon f(x, w_x) = f(y, w_y)
  \end{displaymath}
\end{definition}
\begin{definition}\label{def:npeq8}
  An equivalence relation $R$ is in $\NPEqEight$ if it has a polynomial time computable one-witness complete invariant, that is, a function $f\in\FP$ such that
  \begin{displaymath}
    \pair{x}{y}\in R\iff \exists w\colon f(x, w) = f(y, w)
  \end{displaymath}
\end{definition}

\autoref{fig:inclusions} shows the inclusions among each of the classes of equivalence relations defined above.
\begin{figure}
  \caption{\label{fig:inclusions}Inclusions among possible definitions of equivalence relations verifiable in deterministic polynomial time.}
  \begin{displaymath}
    \xymatrix{%
      \NPEqSeven \ar[r] & \NPEqFive \ar@{<->}[r] & \NPEqThree \ar[r] & \NPEqTwo \ar@{<->}[r] & \NPEqOne \\
      \NPEqEight \ar[u] \ar[r] & \NPEqSix \ar[u] \ar@{<->}[r] & \NPEqFour \ar[u]}
  \end{displaymath}
\end{figure}
The main ideas of these inclusions are presented in the following theorem (the complete proofs are tedious and so are omitted here).
\begin{theorem}\label{thm:definitions}\mbox{}
  \begin{enumerate}
  \item $\NPEqOne=\NPEqTwo$
  \item $\NPEqEight\subseteq\NPEqSix$ and $\NPEqSeven\subseteq\NPEqFive$
  \item $\NPEqSix=\NPEqFour$ and $\NPEqFive=\NPEqThree$
  \item $\NPEqEight\subseteq\NPEqSeven$, $\NPEqSix\subseteq\NPEqFive$, and $\NPEqFour\subseteq\NPEqThree$
  \item $\NPEqThree\subseteq\NPEqTwo$
  \end{enumerate}
\end{theorem}
\begin{sketch}\mbox{}
  \begin{enumerate}
  \item Follows immediately from the standard definitions of \NP.
  \item Choose the relation $R'$ in the definitions of $\NPEqSix$ and $\NPEqFive$ to be the equality relation.
  \item
    For the forward direction, hard-code the function $f$ from the definitions of $\NPEqSix$ and $\NPEqFive$ into the relation $R'$ in the definitions of $\NPEqFour$ and $\NPEqThree$.
    For the reverse direction, keep the relation $R'$ and choose the identity function to be $f$ in the definitions of $\NPEqSix$ and $\NPEqFive$.
  \item Choose $w_x$ and $w_y$ in $\NPEqSeven$, $\NPEqFive$, and $\NPEqThree$ to be equal to the $w$ from $\NPEqEight$, $\NPEqSix$, and $\NPEqFour$.
  \item Define $L=\lb\pair{\pair{x}{y}}{\pair{w_x}{w_y}}\st\pair{\pair{x}{w_x}}{\pair{y}{w_y}}\in R'\rb$, so the witness that $\pair{x}{y}\in L$ is the pair $\pair{w_x}{w_y}$.
    %% TODO This doesn't work, because we could have $(x, y, w)\notin L$ but
    %% still have some w_x, w_y such that $((x, y, w_x), (x, y, w_y))\in R'$,
    %% namely, w_x=w_y, which relies on reflexivity.
    %%
    %% For the reverse direction, define $R'$ by
    %% \begin{align*}
    %%   R'= \{ & \pair{\triple{x}{y}{w_x}}{\triple{x}{y}{w_y}} \,|\, w_x = w_y \text{ or} \\
    %%   & \, \exists b\in\{0, 1\} \,\exists w\in\{0, 1\}^*\colon \\
    %%   & \, w_x = w \circ b, w_y = w\circ \bar{b},\plain{and} \pair{\pair{x}{y}}{w}\in L \}
    %% \end{align*}
    %% and choose $w_x=w\circ 0$ and $w_y=w\circ 1$.
  \end{enumerate}
\end{sketch}

\begin{openproblem}
  Does one of the complexity classes defined here have a complete problem under $\kr$ reductions?
\end{openproblem}
\begin{openproblem}
  Can we prove equality for the remaining classes, or are some of these classes provably distinct?
\end{openproblem}
