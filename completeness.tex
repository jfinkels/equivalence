\begin{definition}
  \hangindent=1.2in
  $R_{KC}=\{((G_1, k_1), (G_2, k_2))| k_1=k_2 \plain{and} (G_1\cong G_2
  \plain{or}\\ (G_1 \plain{has a clique of size} k_1 \plain{and} G_2 \plain{has
  a clique of size} k_2))\}$
\end{definition}

\begin{theorem}$R_{KC}$ is an equivalence relation.\end{theorem}
\begin{proof}To show that $R_{KC}$ is an equivalence relation, we must show
  that it is reflexive, symmetric, and transitive.

  Since $G$ is isomorphic to $G$ for all graphs $G$, $((G,k),(G,k))\in R_{KC}$,
  for all $k\in\mathbb{N}$, so $R_{KC}$ is reflexive.

  To show that $R_{KC}$ is symmetric, suppose $((G_1, k_1), (G_2, k_2))\in
  R_{KC}$. In the case that $G_1$ is isomorphic to $G_2$, then $G_2$ is
  isomorphic to $G_1$ because the isomorphism relation is symmetric, so
  $((G_2,k_2),(G_1,k_1))\in R_{KC}$. In the case that $G_1$ has a clique of
  size $k_1$ and $G_2$ has a clique of size $k_2$ and $k_1=k_2$, then
  $((G_2,k_2),(G_1,k_1))\in R_{KC}$ because the logical conjunction operation
  is commutative over propositions.

  To show that $R_{KC}$ is transitive, suppose $((G_1, k_1), (G_2, k_2))\in
  R_{KC}$ and $((G_2, k_2), (G_3, k_3))\in R_{KC}$. Since $k_1=k_2$ and
  $k_2=k_3$, then $k_1=k_3$ by the transitivity of the equality relation. There
  are four possible cases for the remaining properties.

  In the case that $G_1$ is isomorphic to $G_2$ and $G_2$ is isomorphic to
  $G_3$, then $G_1$ is isomorphic to $G_3$ so $((G_1, k_1), (G_3, k_3))\in
  R_{KC}$.

  In the case that $G_1$ is isomorphic to $G_2$, $G_2$ has a clique of size
  $k_2$, $G_3$ has a clique of size $k_3$, then $G_1$ has a clique of size
  $k_2=k_1$, so $((G_1, k_1), (G_3, k_3))\in R_{KC}$.

  In the case that $G_1$ has a clique of size $k_1$, $G_2$ has a clique of size
  $k_2$, and $G_2$ is isomorphic to $G_3$, then $G_3$ has a clique
  of size $k_2=k_3$, so $((G_1, k_1), (G_3, k_3))\in R_{KC}$.

  In the case that $G_1$ has a clique of size $k_1$, $G_2$ has a clique of size
  $k_2$, and $G_3$ has a clique of size $k_3$, then $((G_1, k_1), (G_3,
  k_3))\in R_{KC}$.

  Therefore $R_{KC}$ is reflexive, symmetric, and transitive, hence it is an
  equivalence relation.
\end{proof}

\begin{definition}$CLIQUE=\{(G,k)|G \plain{has a clique of size}
  k\}$\end{definition}

\begin{lemma}$CLIQUE$ is \NP-complete.\end{lemma}
\begin{proof}
  The proof is a polynomial time reduction from $3SAT$, which is \NP-complete.
\end{proof}

%% TODO rewrite algorithms using \KwIn and \KwOut
\begin{lemma}\label{lem:rkc_np}$R_{KC}\in\NP$\end{lemma}
\begin{proof}
  Since $GI\in\NP$, it has a deterministic polynomial time verifier, $M_1$,
  which accepts on input $(G_1, G_2, c)$, where $c$ is the isomorphism from
  vertices of $G_1$ to vertices of $G_2$.

  Since $CLIQUE\in\NP$, it has a deterministic polynomial time verifier, $M_2$,
  which accepts on input $(G, k, c)$, where $c$ is the set of vertices in $G$
  which comprise a clique of size $k$.

  To show that $R_{KC}\in\NP$, we construct a deterministic polynomial time
  verifier $M$ for $R_{KC}$. On input $(((G_1, k_1), (G_2, k_2)), c)$:\\
  \begin{algorithm}[H]
    If $k_1\neq k_2$, \REJECT\;
    \If{$c$ \textnormal{is the encoding of a mapping}}{
      Run $M_1$ on input $(G_1, G_2, c)$\;
      If $M_1$ accepts, \ACCEPT; otherwise \REJECT\;
    }
    \If{$c=(c_1, c_2)$ \textnormal{is the encoding of two cliques}}{
      Run $M_2$ on input $(G_1, k_1, c_1)$\;
      Run $M_2$ on input $(G_2, k_2, c_2)$\;
      If $M_2$ accepts on both inputs, \ACCEPT; otherwise \REJECT\;
    }
  \end{algorithm}
  
  Machine $M$ is a verifier for $R_{KC}$, so $R_{KC}\in\NP$.
\end{proof}

\begin{corollary}\label{cor:rkc_npeq}$R_{KC}\in\NPEq$\end{corollary}
\begin{proof}
  Since $R_{KC}\in\NP$ by \autoref{lem:rkc_np} and $R_{KC}$ is an equivalence
  problem, then by \autoref{def:peq}, $R_{KC}\in\NPEq$.
\end{proof}

\begin{theorem}\label{thm:rkc_npc}$R_{KC}$ is \NP-complete.\end{theorem}
\begin{proof}
  Since $R_{KC}\in\NP$ by \autoref{lem:rkc_np}, we need only show that $R_{KC}$
  is \NP-hard. To do this, we construct a polynomial time many-one reduction
  from $CLIQUE$, which is \NP-complete, to $R_{KC}$.

  Construct machine $M\in\FP$ on input $(G, k)$ which outputs $((G, k), (K_k,
  k))$, where $K_k$ is the complete graph with $k$ vertices.

  Suppose $(G,k)\in CLIQUE$, so $G$ has a clique of size $k$. Then
  $M((G,k))=((G,k), (K_k, k))\in R_{KC}$, because $G$ has a clique of size
  $k$ by hypothesis and $K_k$ has a clique of size $k$ by construction,
  specifically, the set of all vertices in $K_k$.
  
  Suppose $(G,k)\notin CLIQUE$, so $G$ does not have a clique of size $k$ and
  $M((G,k))=((G,k), (K_k, k))$. If $G$ were isomorphic to $K_k$, then it would
  have a clique of size $k$, specifically the set of all its vertices, but this
  is a contradiction with the hypothesis so no such isomorphism
  exists. Although $K_k$ certainly has a clique of size $k$, specifically the
  set of all its vertices, $G$ does not have a clique of size $k$ by
  hypothesis, so $((G, k), (K_k, k))\notin R_{KC}$.
  
  Therefore $(G,k)\in CLIQUE\iff M((G,k))\in R_{KC}$, so $CLIQUE\mor R_{KC}$,
  and hence $R_{KC}$ is \NP-complete.
\end{proof}

\begin{theorem}$\NPC\cap\NPEq\neq\emptyset$\end{theorem}
\begin{proof}
  By \autoref{cor:rkc_npeq}, $R_{KC}\in\NPEq$, and by \autoref{thm:rkc_npc},
  $R_{KC}\in\NPC$, so $R_{KC}\in\NPEq\cap\NPC$.
\end{proof}

Since $R_{KC}$ is both in $\NPEq$ and \NP-complete, we want to show that it may
be a candidate for an \NPEq-complete, problem. In other words, is it true that
all equivalence problems in $\NPEq$ kernel reduce to $R_{KC}$? A handful of
equivalence problems in $\NPEq$ kernel reduce to graph isomorphism, and as the
following theorem shows, we can kernel reduce the graph isomorphism problem to
$R_{KC}$.

\begin{theorem}$GI\kr R_{KC}$\end{theorem}
\begin{proof}
  Construct machine $f\in\FP$ defined for all graphs $G=(V,E)$ by
  $f(G)=(G,|V|+1)$.

  Let $G_1=(V_1, E_1)$ and $G_2=(V_2, E_2)$, and suppose $(G_1, G_2)\in GI$, so
  $G_1$ is isomorphic to $G_2$. This implies $|V_1|=|V_2|$ and thus
  $|V_1|+1=|V_2|+1$. Now $f(G_1)=(G_1, |V_1|+1)$ and $f(G_2)=(G_2,
  |V_2|+1)$. Since $G_1$ is isomorphic to $G_2$ and $|V_1|+1=|V_2|+1$, then
  $((G_1, |V_1|+1),(G_2, |V_2|+1))=(f(G_1), f(G_2))\in R_{KC}$.
  
  Suppose $(G_1, G_2)\notin GI$, so $G_1$ is not isomorphic to $G_2$. Since
  $G_1$ cannot have a clique of size $|V_1|+1$, and further, since $G_2$ cannot
  have a clique of size $|V_2|+1$, then $((G_1, |V_1|+1), (G_2,
  |V_2|+1))=(f(G_1), f(G_2))\notin R_{KC}$.

  Therefore $(G_1, G_2)\in GI\iff (f(G_1), f(G_2))\in R_{KC}$, so $GI\kr
  R_{KC}$.
\end{proof}


%% TODO rewrite this section

Now the question is where does $\GIm$ live? There exist exotic problems which
are not equivalence problems, but which are polynomial-time many-one equivalent
to the graph isomorphism problem. For example, Kozen's M-tree clique problem,
the problem of recognizing a legitimate regular deck, and the problem of
recognizing a self-complementary graph are \emph{not} equivalence problems, but
they are indeed polynomial-time many-one equivalent to the graph isomorphism
problem. Since they are not equivalence relations, they certainly cannot be
kernel reduced to graph isomorphism, so $\GIker\subsetneq\GIm$.
%% TODO references

The next question is are there equivalence relations which many-one reduce to
graph isomorphism but which do not kernel reduce to graph isomorphism?
Informally, the question asks if there is some reduction relations such that
the reduction \emph{requires} information about both elements in each pair
(because a many-one reduction gets access to both elements $x$ and $y$ when
$(x,y)\in R$ whereas a kernel reduction gets access only to one at a time). In
fact, the problem of recognizing a self-complementary graph, when expressed as
an equivalence relation, may be a candidate for such a problem.

Examining most of the other problems in the class $\GIm$ reveals that nearly
all other (known) reductions can be expressed as kernel reductions. Many of the
techniques involve either edge replacement or composition of graphs, which can
both be performed on either graph without knowledge of the other. However, the
self-complementary graph problem, which is $SCGI=\{G|G \plain{is isomorphic to}
\bar{G}\}$, does not seem to have this property. Note that this set can be
alternately defined as an equivalence relation, $SCGI=\{(G_1,
G_2)|G_1=\bar{G_2} or \}$.
